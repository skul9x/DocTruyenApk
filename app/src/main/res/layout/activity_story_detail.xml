<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/background"
    android:fillViewport="true">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical">

        <!-- Header with Image -->
        <!-- Responsive height: uses weight for better scaling across devices -->
        <FrameLayout
            android:layout_width="match_parent"
            android:layout_height="0dp"
            android:minHeight="200dp"
            android:layout_weight="0.35">

            <ImageView
                android:id="@+id/imgStoryDetail"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:scaleType="centerCrop"
                android:contentDescription="@string/cd_story_image"
                tools:src="@color/primary_light" />

            <!-- Gradient Overlay -->
            <View
                android:layout_width="match_parent"
                android:layout_height="120dp"
                android:layout_gravity="bottom"
                android:background="@drawable/gradient_story_overlay" />

            <!-- Back Button -->
            <com.google.android.material.floatingactionbutton.FloatingActionButton
                android:id="@+id/btnBack"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginStart="16dp"
                android:layout_marginTop="64dp"
                android:src="@android:drawable/ic_menu_revert"
                app:fabSize="mini"
                app:backgroundTint="@color/background_card"
                app:tint="@color/text_primary"
                android:contentDescription="@string/cd_back_button" />

        </FrameLayout>

        <!-- Content Card -->
        <com.google.android.material.card.MaterialCardView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="-40dp"
            android:layout_marginHorizontal="16dp"
            app:cardCornerRadius="24dp"
            app:cardElevation="8dp">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="24dp">

                <!-- Title -->
                <TextView
                    android:id="@+id/tvTitle"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:textSize="24sp"
                    android:textStyle="bold"
                    android:textColor="@color/text_primary"
                    android:gravity="center"
                    tools:text="Cô Bé Quàng Khăn Đỏ" />

                <!-- Divider -->
                <View
                    android:layout_width="60dp"
                    android:layout_height="4dp"
                    android:layout_gravity="center"
                    android:layout_marginVertical="16dp"
                    android:background="@color/primary" />

                <!-- TTS Controls -->
                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:gravity="center"
                    android:orientation="horizontal"
                    android:layout_marginBottom="20dp"
                    android:weightSum="10">

                    <!-- Play/Pause Button (60% width) -->
                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/btnPlayPause"
                        android:layout_width="0dp"
                        android:layout_weight="6"
                        android:layout_height="56dp"
                        android:text="@string/btn_read_story"
                        android:textSize="14sp"
                        android:textStyle="bold"
                        android:maxLines="1"
                        android:ellipsize="end"
                        app:cornerRadius="28dp"
                        app:backgroundTint="@color/tts_play"
                        app:icon="@android:drawable/ic_media_play"
                        app:iconGravity="textStart"
                        app:iconPadding="4dp"
                        app:iconSize="20dp"
                        android:insetTop="0dp"
                        android:insetBottom="0dp"
                        android:paddingHorizontal="12dp"
                        android:contentDescription="@string/cd_play_button" />

                    <!-- Stop Button (40% width) - with text protection -->
                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/btnStop"
                        android:layout_width="0dp"
                        android:layout_weight="4"
                        android:layout_height="56dp"
                        android:layout_marginStart="8dp"
                        android:text="@string/btn_stop_reading"
                        android:textSize="14sp"
                        android:textStyle="bold"
                        android:maxLines="1"
                        android:ellipsize="end"
                        app:autoSizeTextType="uniform"
                        app:autoSizeMinTextSize="10sp"
                        app:autoSizeMaxTextSize="14sp"
                        app:cornerRadius="28dp"
                        app:backgroundTint="@color/tts_stop"
                        app:icon="@android:drawable/ic_menu_close_clear_cancel"
                        app:iconGravity="textStart"
                        app:iconPadding="2dp"
                        app:iconSize="18dp"
                        android:insetTop="0dp"
                        android:insetBottom="0dp"
                        android:paddingHorizontal="8dp"
                        android:enabled="false"
                        android:alpha="0.5"
                        android:contentDescription="@string/cd_stop_button" />

                </LinearLayout>

                <!-- TTS Status - Use INVISIBLE to prevent layout shift -->
                <TextView
                    android:id="@+id/tvTtsStatus"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:minHeight="20dp"
                    android:gravity="center"
                    android:textSize="14sp"
                    android:textColor="@color/text_secondary"
                    android:visibility="invisible"
                    tools:text="Đang đọc truyện..."
                    tools:visibility="visible" />

                <!-- TTS Progress Indicator -->
                <com.google.android.material.progressindicator.LinearProgressIndicator
                    android:id="@+id/progressTts"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="8dp"
                    android:layout_marginHorizontal="32dp"
                    app:indicatorColor="@color/primary"
                    app:trackColor="@color/primary_light"
                    app:trackCornerRadius="4dp"
                    android:indeterminate="true"
                    android:visibility="gone"
                    tools:visibility="visible" />

                <!-- Loading Indicator -->
                <LinearLayout
                    android:id="@+id/loadingContainer"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="vertical"
                    android:gravity="center"
                    android:layout_marginTop="20dp"
                    android:visibility="visible">

                    <ProgressBar
                        android:id="@+id/progressLoading"
                        android:layout_width="48dp"
                        android:layout_height="48dp"
                        android:indeterminate="true" />

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="8dp"
                        android:text="@string/loading"
                        android:textColor="@color/text_secondary" />

                </LinearLayout>

                <!-- Error Container with Retry -->
                <LinearLayout
                    android:id="@+id/errorContainer"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="vertical"
                    android:gravity="center"
                    android:layout_marginTop="20dp"
                    android:visibility="gone">

                    <TextView
                        android:id="@+id/tvErrorMessage"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="@string/error_loading"
                        android:textColor="@color/text_secondary"
                        android:textSize="16sp" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/btnRetry"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="12dp"
                        android:text="@string/retry"
                        app:icon="@android:drawable/ic_menu_rotate"
                        style="@style/Widget.Material3.Button.OutlinedButton" />

                </LinearLayout>

                <!-- Story Content -->
                <TextView
                    android:id="@+id/tvContent"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="20dp"
                    android:textSize="18sp"
                    android:textColor="@color/text_primary"
                    android:lineSpacingMultiplier="1.6"
                    android:visibility="gone"
                    tools:text="Ngày xửa ngày xưa, trong một khu rừng nọ có một cô bé xinh xắn được mọi người gọi là Cô bé quàng khăn đỏ vì lúc nào cô cũng đội chiếc khăn đỏ xinh xắn mà bà ngoại đã may tặng..." />

            </LinearLayout>

        </com.google.android.material.card.MaterialCardView>

        <!-- Bottom Spacing -->
        <View
            android:layout_width="match_parent"
            android:layout_height="40dp" />

    </LinearLayout>

</ScrollView>
